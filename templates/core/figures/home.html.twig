{% extends 'base.html.twig' %}

{% block title %}Bienvenue
{% endblock %}

{% block body %}
	<div class="imageHero px-0">
		<h1>SNOWTRICKS</h1>
		<div class="accroche">
			<h2>Devient un pro du snow !</h2>
		</div>
		<p>
			<strong>Bienvenue sur notre site collaboratif.</strong>
		</p>
		<div class="arrow-down">
			<a href="#Tricks-list">
				<i class="fas fa-arrow-down fa-3x" style="color:white;"></i>
			</a>
		</div>
	</div>
	<div class="container-fluid">
		<h2 class="mt-2 mb-4 text-center" id="Tricks-list">Liste des figures</h2>

		<div class="row mx-5" id="container-figures">

			{# {% for figure in figures %}

				<div class="col-sm-12 col-md-12 col-lg-3">
					<div class="card bg-light border mb-3 rounded-3">
						<img src="{{figure.coverImage}}" alt="Image de la figure" style="height: 200px; width:100%; display: block;">
						<div class="card-body">
							<div class="row mx-0 px-0">
								<div class="col-8 mx-0 px-0">
									<h5 class="card-title">{{figure.name}}</h5>
								</div>
								<div class="col-4 mx-0 px-0">
									<a href="#" class="btn btn-info">
										<i class="fas fa-edit"></i>
									</a>
									<a href="#" class="btn btn-danger">
										<i class="fas fa-trash-alt"></i>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>

			{% endfor %} #}

			{# {% include '__list_figures.html.twig' with {'figures': figures} %} #}

		</div>

		<div style="display:flex; justify-content:center;">
			<button class="btn btn-primary my-3" id="load-more" data-total-page="{{ pageTotal }}" data-next-page="{{ page + 1 }}" data-figure-ajax="{{ path('get_figure_ajax')}}">Charger plus</button>
		</div>
	</div>

	{% block javascripts %}
		<script type="text/javascript">
			const element = document.querySelector('#load-more');
            const containerfigures = document.querySelector('#container-figures');
			const loader = document.querySelector('.loading');

            element.addEventListener('click', async (e) => { 
			loader.style.display='block';	
            const totalPage = e.target.dataset.totalPage;
            const nextPage = e.target.dataset.nextPage;
            const urlToCallAjax = e.target.dataset.figureAjax;
            //Asynchrone response ajax
            const response = await fetch(`${urlToCallAjax}?page=${nextPage}`);
            console.log(response);

            if(response.ok) {
				loader.style.display='none';
                const data = await response.json();
                // if all page display thon disabled button
                if((Number(nextPage)) === Number(totalPage)) {
                    element.disabled = true;
                }
                // else increment to one the attribute value "data-next-page" in tag button
                element.dataset.nextPage = Number(nextPage) + 1;
                //add figures bellow page
                containerfigures.innerHTML += data.html;
            }

            });

		</script>
	{% endblock %}

{% endblock %}
