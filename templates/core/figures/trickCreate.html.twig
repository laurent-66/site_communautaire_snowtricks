{% extends "base.html.twig" %}
{% block title %}Création trick{% endblock %}

{% block body %} 
<div class="container-fluid mx-0 my-0 px-0 mx-0" id="register">
    <div class="container-fluid container-body">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <div class="container card rounded shadow p-3 mb-5">
                    {# {% if error %}
                    <div class="alert alert-danger" role="alert">
                        {{ error }}
                    </div>
                    {% endif %} #}

                    <h2 class="text-center">Création Trick</h2>
                    {{form_start(formTrick)}}
                    {{form_row(formTrick.name)}}
                    {{form_widget(formTrick.coverImage)}}
                    {{form_row(formTrick.description)}}
                    {{form_widget(formTrick.figureGroup)}}

                    <ul class="illustrations" data-index="{{ formTrick.illustrations|length > 0 ? formTrick.illustrations|last.vars.illustrations + 1 : 0 }}" data-prototype="{{ form_widget(formTrick.illustrations.vars.prototype)|e('html_attr') }}"></ul>
                    <button type="button" class="add_item_link_image btn btn-lg btn-secondary btn-block mb-3" data-collection-holder-class="illustrations">Ajouter une image</button>
                    <ul class="videos" data-index="{{ formTrick.videos|length > 0 ? formTrick.videos|last.vars.videos + 1 : 0 }}" data-prototype="{{ form_widget(formTrick.videos.vars.prototype)|e('html_attr') }}"></ul>
                    <button type="button" class="add_item_link_video btn btn-lg btn-secondary btn-block mb-3" data-collection-holder-class="videos">Ajouter une vidéo</button>
                    <button class="btn btn-lg btn-primary btn-block mb-3" type="submit">Valider</button>
                    {{form_end(formTrick)}}
                </div>
            </div>
        </div>       
    </div>
</div>
{% endblock %} 
{% block javascripts %}
<script>

    const addFormToCollection = (e) => {
    const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

    const item = document.createElement('li');

    item.innerHTML = collectionHolder
        .dataset
        .prototype
        .replace(
        /__name__/g,
        collectionHolder.dataset.index
        );

    collectionHolder.appendChild(item);

    collectionHolder.dataset.index++;

    };


    document.querySelectorAll('.add_item_link_image')
    .forEach(btn => btn.addEventListener("click", addFormToCollection));

    document.querySelectorAll('.add_item_link_video')
    .forEach(btn => btn.addEventListener("click", addFormToCollection));




</script>
{% endblock %}